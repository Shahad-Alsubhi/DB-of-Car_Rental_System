drop database car_Rental;
create database car_Rental;
-- create database car_Rental;
use car_Rental;
CREATE TABLE CUSTOMER ( 
DL_NUMBER         CHAR(8) PRIMARY KEY, 
FNAME             VARCHAR(25) NOT NULL,
LNAME             VARCHAR(25) NOT NULL,
PHONE_NUMBER      int(10) NOT NULL,
EMAIL             VARCHAR(30) NOT NULL, 
National_Address  VARCHAR(20) NOT NULL
 );
 
 -- Car Category Details
 CREATE TABLE CAR_CATEGORY (
 CATEGORY_NAME     VARCHAR(25) PRIMARY KEY,
 NO_OF_PERSON      INTEGER NOT NULL,
 COST_PER_DAY      integer NOT NULL,
 LATE_FEE_PER_HOUR integer NOT NULL); 
 
 
 -- office 
CREATE TABLE office (
 office_ID      VARCHAR(50)  PRIMARY KEY,
 LOCATION_ID   VARCHAR(50) 
);
 
 -- car Details
 CREATE TABLE CAR( 
 REGISTRATION_NUMBER CHAR(7) PRIMARY KEY,
 MODEL_NAME          VARCHAR(25) NOT NULL, 
 MAKE                VARCHAR(25) NOT NULL, 
 MODEL_YEAR          int NOT NULL, 
 CAR_CATEGORY_NAME   VARCHAR(25) NOT NULL, 
 LOC_ID              VARCHAR(50) NOT NULL, 
 AVAILABILITY_FLAG   VARCHAR(1) NOT NULL,
  FOREIGN KEY (CAR_CATEGORY_NAME) REFERENCES CAR_CATEGORY(CATEGORY_NAME),
  FOREIGN KEY (LOC_ID) REFERENCES office(office_ID) );

-- Booking Details 
 CREATE TABLE BOOKING( 
 BOOKING_ID          CHAR(5) PRIMARY KEY , 
 FROM_DT_TIME        TIMESTAMP NOT NULL, 
 RET_DT_TIME         TIMESTAMP NOT NULL, 
 AMOUNT              int NOT NULL, 
 BOOKING_STATUS      CHAR(1) NOT NULL, 
 PICKUP_LOC          CHAR(4) NOT NULL, 
 DROP_LOC            CHAR(4) NOT NULL, 
 REG_NUM             CHAR(7) NOT NULL, 
 DL_NUM              CHAR(8) NOT NULL, 
 ACT_RET_DT_TIME     TIMESTAMP, 
 
 CONSTRAINT BOOKINGFK1 FOREIGN KEY (PICKUP_LOC) REFERENCES office(office_ID), 
  CONSTRAINT BOOKINGFK2 FOREIGN KEY (DROP_LOC) REFERENCES office(office_ID),
   CONSTRAINT BOOKINGFK3 FOREIGN KEY (REG_NUM) REFERENCES CAR(REGISTRATION_NUMBER), 
 CONSTRAINT BOOKINGFK4 FOREIGN KEY (DL_NUM) REFERENCES CUSTOMER(DL_NUMBER)
 );
 
-- Billing Details
CREATE TABLE BILLING(
 BILL_ID        CHAR(6) PRIMARY KEY,
 BILL_DATE      DATE NOT NULL,
 BILL_STATUS    CHAR(1) NOT NULL,
 TOTAL_AMOUNT   int NOT NULL,
 TAX_AMOUNT     int NOT NULL,
 BOOKING_NUM    CHAR(5) NOT NULL,
 TOTAL_LATE_FEE int NOT NULL,
 FOREIGN KEY (BOOKING_NUM) REFERENCES BOOKING(BOOKING_ID)
);

create table ADMIN_(
ID_ADMIN  INT primary KEY,
ADMIN_NAME varchar(50),
ADMIN_PHONE INT,
ADMIN_OFFICE VARCHAR(50),
FOREIGN KEY (ADMIN_OFFICE)REFERENCES OFFICE(OFFICE_ID)
);

create table employee(
employee_id int primary key,
fullname  varchar(50),
phone_number int,
office_id  varchar(50),
admin_id int,
foreign key(office_id) references office(office_id),
foreign key (admin_id)references admin_(id_admin)
);


-- INSERT CUSTOMER DETAILS
 INSERT INTO CUSTOMER VALUES('F1234554', 'Abdulwahhab' ,'Althebyani','0596004267', 'abdulwahhab@gmail.com','MWBA8642');
INSERT INTO CUSTOMER VALUES('F9764521', 'Asim' ,'Alsulami','0596478596', 'Asim7@gmail.com','MWNA6857');
INSERT INTO CUSTOMER VALUES('F2345611', 'Basma', 'refaee','0589187546', 'Basma2234@gmail.com','MWNA8642');
 INSERT INTO CUSTOMER VALUES('R8763578', 'Rania', 'Alsahafee','0545678902', 'Rania56@gmail.com','MDHA4906');
INSERT INTO CUSTOMER VALUES('I3478953', 'Samer', 'Alsulimani','0572563478', 'Samer78@gmail.com','MDHB4930');
INSERT INTO CUSTOMER VALUES('E7521097', 'Rabab' ,'AbuAyeed','0598123429', 'Rabab@gmail.com','MDHB4948');
 INSERT INTO CUSTOMER VALUES('T0981237', 'Mohammed' ,'Alshabhi','0512890345', 'Mohammed@gmail.com','JINA2601');
 INSERT INTO CUSTOMER VALUES('F0091266','Rami', 'Sanani','0592340918', 'Rami@gmail.com','JINA2581');
 INSERT INTO CUSTOMER VALUES('P1234567', 'Nada' ,'Mohamed' ,'0586502489', 'Nadax@gmail.com','JJMA3351');
INSERT INTO CUSTOMER VALUES('V5690245','Hamed', 'Alamoudi','0508762514', 'hamedd90@gmail.com','JJWA2426');
 
 -- INSERT CAR CATEGORY 
INSERT INTO CAR_CATEGORY VALUES('ECONOMY',5,112,4);
INSERT INTO CAR_CATEGORY VALUES('COMPACT',5,120,3.61);
INSERT INTO CAR_CATEGORY VALUES('MID SIZE',5,131,4);
INSERT INTO CAR_CATEGORY VALUES('STANDARD',5,142,4.25);
INSERT INTO CAR_CATEGORY VALUES('FULL SIZE',5,150,4.5);
INSERT INTO CAR_CATEGORY VALUES('LUXURY CAR',5,280,8.5);
INSERT INTO CAR_CATEGORY VALUES('MID SIZE SUV',5,135,4);
INSERT INTO CAR_CATEGORY VALUES('STANDARD SUV',5,150,4.5);
INSERT INTO CAR_CATEGORY VALUES('FULL SIZE SUV',8,225,7);
INSERT INTO CAR_CATEGORY VALUES('MINI VAN',7,263,8);

-- LOCATION DETAILS
INSERT INTO office VALUES('L101','King Abdulaziz International Airport');
INSERT INTO office VALUES('L102','King Saud Domestic Airport');
INSERT INTO office VALUES('L103','King Khaled International Airport');

-- car
INSERT INTO CAR VALUES('ABX1234','CIVIC','HONDA',2014,'ECONOMY','L101','A');
INSERT INTO CAR VALUES('SDF4567','FIESTA','FORD',2015,'ECONOMY','L102','N');
INSERT INTO CAR VALUES('WER3245','ACCENT','HYUNDAI',2014,'ECONOMY','L103','A');
INSERT INTO CAR VALUES('GLZ2376','COROLLA','TOYOTA',2016,'ECONOMY','L101','A');
INSERT INTO CAR VALUES('HJK1234','CIVIC','HONDA',2015,'ECONOMY','L101','N');
INSERT INTO CAR VALUES('GLS7625','FOCUS','FORD',2014,'COMPACT','L103','A');
INSERT INTO CAR VALUES('FKD8202','GOLF','VOLKSWAGAN',2016,'COMPACT','L103','A');
INSERT INTO CAR VALUES('HNX1890','PRIUS','TOYOTA',2015,'COMPACT','L103','N');
INSERT INTO CAR VALUES('KJS1983','PRIUS','TOYOTA',2014,'COMPACT','L103','A');
INSERT INTO CAR VALUES('SDL9356','FOCUS','FORD',2016,'COMPACT','L103','A');
INSERT INTO CAR VALUES('OTY7293','CRUZE','CHEVROLET',2016,'MID SIZE','L102','A');
INSERT INTO CAR VALUES('QWE4562','LEGACY','SUBARU',2012,'MID SIZE','L101','A');
INSERT INTO CAR VALUES('CXZ2356','AVENGER','DODGE',2015,'MID SIZE','L102','A');
INSERT INTO CAR VALUES('ASD9090','ACCORD','HONDA',2016,'MID SIZE','L103','A');
INSERT INTO CAR VALUES('UYT3981','LEGACY','SUBARU',2013,'MID SIZE','L101','A');
INSERT INTO CAR VALUES('TRE9726','200','CHRYSTLER',2012,'STANDARD','L101','A');
INSERT INTO CAR VALUES('HGF5628','TAURUS','FORD',2013,'STANDARD','L102','A');
INSERT INTO CAR VALUES('LKJ7253','200','CHRYSTLER',2014,'STANDARD','L103','A');
INSERT INTO CAR VALUES('VBN6283','TAURUS','FORD',2015,'STANDARD','L102','A');
INSERT INTO CAR VALUES('POI7281','200','CHRYSTLER',2016,'STANDARD','L102','N');
INSERT INTO CAR VALUES('MNB8654','FALCON','FORD',2012,'FULL SIZE','L103','A');
INSERT INTO CAR VALUES('UHV9786','IMPALA','CHEVROLET',2013,'FULL SIZE','L101','A');
INSERT INTO CAR VALUES('EFB5427','WAYFARER','FORD',2014,'FULL SIZE','L103','A');
INSERT INTO CAR VALUES('PLM9873','IMPALA','CHEVROLET',2015,'FULL SIZE','L101','A');
INSERT INTO CAR VALUES('WDV2458','FALCON','FORD',2016,'FULL SIZE','L102','A');
INSERT INTO CAR VALUES('QSC8709','MKZ','LINCOLN',2012,'LUXURY CAR','L102','A');
INSERT INTO CAR VALUES('TGB8961','GENESIS','HYUNDAI',2013,'LUXURY CAR','L102','A');
INSERT INTO CAR VALUES('MKU0172','TLX','ACURA',2014,'LUXURY CAR','L103','A');
INSERT INTO CAR VALUES('CFT1908','328I','BMW',2015,'LUXURY CAR','L103','A');
INSERT INTO CAR VALUES('WHM7619','AVALON','TOYOTA',2016,'LUXURY CAR','L101','A');
INSERT INTO CAR VALUES('WLZ8955','ESCAPE','FORD',2012,'MID SIZE SUV','L102','A');
INSERT INTO CAR VALUES('QIO7621','EQUINOX','CHEVROLET',2013,'MID SIZE SUV','L103','A');
INSERT INTO CAR VALUES('YSN1927','PATHFINDER','NISSAN',2014,'MID SIZE SUV','L101','A');
INSERT INTO CAR VALUES('EDM8610','GLA','MERCEDEZ BENZ',2015,'MID SIZE SUV','L102','A');
INSERT INTO CAR VALUES('AHK7325','RAV4','TOYOTA',2016,'MID SIZE SUV','L103','A');
INSERT INTO CAR VALUES('OHZ0976','EDGE','FORD',2012,'STANDARD SUV','L102','A');
INSERT INTO CAR VALUES('RKS9862','TAHOE','CHEVROLET',2013,'STANDARD SUV','L102','A');
INSERT INTO CAR VALUES('WIJ6190','EDGE','FORD',2014,'STANDARD SUV','L102','A');
INSERT INTO CAR VALUES('ZDT8612','TAHOE','CHEVROLET',2015,'STANDARD SUV','L101','A');
INSERT INTO CAR VALUES('LDJ7719','EDGE','FORD',2016,'STANDARD SUV','L101','A');
INSERT INTO CAR VALUES('UIA8709','EXPEDITION','FORD',2012,'FULL SIZE SUV','L102','A');
INSERT INTO CAR VALUES('WKJ7972','SEQUOIA','TOYOTA',2013,'FULL SIZE SUV','L103','A');
INSERT INTO CAR VALUES('JLS1097','SUBURBAN','CHEVROLET',2014,'FULL SIZE SUV','L103','A');
INSERT INTO CAR VALUES('UHJ6782','EXPEDITION','FORD',2015,'FULL SIZE SUV','L101','A');
INSERT INTO CAR VALUES('XBM6822','SUBURBAN','CHEVROLET',2016,'FULL SIZE SUV','L102','A');
INSERT INTO CAR VALUES('SHK7767','QUEST','NISSAN',2012,'MINI VAN','L102','A');
INSERT INTO CAR VALUES('JSL7920','ODYSSEY','HONDA',2013,'MINI VAN','L103','A');
INSERT INTO CAR VALUES('PAJ5289','GRAND CARAVAN','DODGE',2014,'MINI VAN','L102','A');
INSERT INTO CAR VALUES('TSJ6290','QUEST','NISSAN',2015,'MINI VAN','L101','A');
INSERT INTO CAR VALUES('MWO9296','ODYSSEY','HONDA',2016,'MINI VAN','L103','A');

-- INSERT BOOKING DETAILS
INSERT INTO BOOKING VALUES('B1001',TIMESTAMP('2022-01-20 10:00:00'),TIMESTAMP('2022-01-25 10:00:00'),
150,'R','L101','L101','ABX1234','F1234554',TIMESTAMP('2022-01-25 10:00:00'));
INSERT INTO BOOKING VALUES('B1002',TIMESTAMP('2022-01-21 11:00:00'),TIMESTAMP('2022-01-24 10:00:00'),
90,'C','L102','L102','SDF4567','T0981237',NULL);
INSERT INTO BOOKING VALUES('B1003',TIMESTAMP('2022-02-10 13:00:00'),TIMESTAMP('2022-01-15 13:00:00'),
450,'R','L102','L102','QSC8709','R8763578',TIMESTAMP('2022-01-15 13:00:00'));
INSERT INTO BOOKING VALUES('B1004',TIMESTAMP('2022-04-24 13:00:00'),TIMESTAMP('2022-04-25 20:30:00'),
48,'R','L102','L103','WLZ8955','F0091266',TIMESTAMP('2022-04-23 20:30:00'));
INSERT INTO BOOKING VALUES('B1005',TIMESTAMP('2022-04-18 09:00:00'),TIMESTAMP('2022-04-25 09:00:00'),
266,'B','L102','L102','POI7281','P1234567',NULL);
INSERT INTO BOOKING VALUES('B1006',TIMESTAMP('2022-04-21 17:00:00'),TIMESTAMP('2022-04-25 17:00:00'),
168,'B','L103','L103','HNX1890','V5690245',NULL);
INSERT INTO BOOKING VALUES('B1007',TIMESTAMP('2022-04-16 08:00:00'),TIMESTAMP('2022-04-25 17:00:00'),
405,'B','L102','L102','SDF4567','I3478953',NULL);
INSERT INTO BOOKING VALUES('B1008',TIMESTAMP('2022-04-11 08:00:00'),TIMESTAMP('2022-04-25 17:00:00'),
630,'B','L101','L102','HJK1234','T0981237',NULL);


-- INSERT BILLING DETAILS
INSERT INTO BILLING VALUES('BL1001',date('2022-01-25'),'P',138.03,12.38 ,'B1001',0);
INSERT INTO BILLING VALUES('BL1002',date('2022-01-15'),'P' ,487.13 ,12.38 ,'B1003',0);
INSERT INTO BILLING VALUES('BL1003',date('2022-04-24'),'P' ,41.57 ,3.96 ,'B1003',0);

-- insert admin 
insert into admin_ values(0115,'Wail Mofreh',0576549879,'L101');
insert into admin_ values(0113,'Fahad Hazefi',0566567887,'L103');
insert into admin_ values(0112,'Basam Alsulami',0545434267,'L102');

-- insert employee
insert into employee values(1,'Saeed Omar',0578567432,'L101',0115);
insert into employee values(2,'Abdullah Mohamed',0585432192,'L101',0115);
insert into employee values(3,'Fayza Housni',0555546785,'L102',0112);
insert into employee values(4,'Saud Bashrahel',0587544325,'L102',0112);
insert into employee values(5,'Naif Gezani',0587667575,'L103',0113);
insert into employee values(6,'Ahmad Bashrahel',0587667575,'L103',0113);

-- drop view avilable_car;
-- customer view
create view   Avilable_car
as select    car_CATEGORY_NAME,MODEL_NAME,MAKE,MODEL_YEAR,COST_PER_DAY,LATE_FEE_PER_HOUR,office_ID
from  CAR_CATEGORY  join  (car join office on loc_id=office_id) on CATEGORY_name=CAR_CATEGORY_NAME
where AVAILABILITY_FLAG='A';

select * from Avilable_car ;
select * from Avilable_car where office_id='L101';

-- DROP VIEW CUSTOMER_BOOKING;
create view customer_booking
as select FNAME,LNAME,DL_NUMBER,BOOKING_ID,FROM_DT_TIME,RET_DT_TIME,PICKUP_LOC AS PICKUP_OFFICE,DROP_LOC AS DROP_OFFICE,REGISTRATION_NUMBER,MODEL_NAME,MAKE,MODEL_YEAR,CAR_CATEGORY_NAME
from BOOKING ,CAR,CUSTOMER,OFFICE,CAR_CATEGORY
WHERE  REG_NUM=REGISTRATION_NUMBER AND  DL_NUM=DL_NUMBER AND  DROP_LOC=OFFICE_ID AND CAR_CATEGORY_NAME=CATEGORY_NAME ;
SELECT* FROM CUSTOMER_BOOKING WHERE DL_NUMBER='F1234554';

-- drop VIEW CUSTOMER_BILLING;
CREATE VIEW CUSTOMER_BILLING
AS select FNAME,LNAME,DL_NUMBER,BILL_ID,BILL_DATE,TOTAL_AMOUNT,BOOKING_ID
FROM BILLING JOIN (BOOKING JOIN CUSTOMER ON DL_NUM=DL_NUMBER)ON BOOKING_NUM=BOOKING_ID;
SELECT* FROM CUSTOMER_BILLING WHERE DL_NUMBER='F0091266';

-- CUSTOMER VIEW
CREATE VIEW EMPLOYEE_CUSTOMER_BOOKING 
 AS SELECT   FNAME,LNAME,DL_NUMBER,BOOKING_ID,FROM_DT_TIME,RET_DT_TIME,PICKUP_LOC AS PICKUP_OFFICE,DROP_LOC AS DROP_OFFICE,REGISTRATION_NUMBER
 FROM  CUSTOMER,BOOKING,CAR
WHERE  DL_NUM=DL_NUMBER AND REG_NUM=REGISTRATION_NUMBER;

SELECT * FROM EMPLOYEE_CUSTOMER_BOOKING WHERE DROP_OFFICE='L101' OR PICKUP_OFFICE='L101';


-- VIEW ADMIN 
-- DROP VIEW ADMIN_EMPLOYEE;
CREATE VIEW ADMIN_EMPLOYEE
AS SELECT EMPLOYEE_ID,FULLNAME,PHONE_NUMBER,OFFICE_ID,ADMIN_NAME ,ID_ADMIN
FROM EMPLOYEE,ADMIN_
WHERE ADMIN_ID=ID_ADMIN;
SELECT * FROM ADMIN_EMPLOYEE WHERE ID_ADMIN=115;

-- UPDATE
UPDATE employee 
SET  phone_number= '555872314'
WHERE employee_id = 2;

-- Delet
DELETE FROM car WHERE REGISTRATION_NUMBER='MWO9296';


-- Any
SELECT MAKE,REGISTRATION_NUMBER
FROM car
WHERE CAR_CATEGORY_NAME = ANY
  (SELECT CATEGORY_NAME
  FROM car_category
  WHERE COST_PER_DAY = 120);

-- join
SELECT REGISTRATION_NUMBER,MODEL_NAME,MAKE,office_ID
FROM CAR
left JOIN office
ON LOC_ID=OFFICE_ID;

-- ditinct
SELECT distinct car_category_name FROM CAR;

-- max
select CATEGORY_NAME,max(cost_per_day) from car_category;

-- orderd by
select * from car_category order by COST_PER_DAY;